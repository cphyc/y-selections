(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var YSelections;

YSelections = (function() {
  function YSelections() {}

  YSelections.prototype._name = "Selections";

  YSelections.prototype._getModel = function(Y, Operation) {
    if (this._model == null) {
      this._model = new Operation.Composition(this, []).execute();
    }
    return this._model;
  };

  YSelections.prototype._setModel = function(_model) {
    this._model = _model;
  };

  YSelections.prototype._apply = function(delta) {
    var count, createSelection, cut_selection, end, extendSelection, from, o, selection, start, to;
    from = this._model.HB.getOperation(delta.from);
    to = this._model.HB.getOperation(delta.to);
    createSelection = function(from, to, attrs) {
      var n, new_attrs, v;
      new_attrs = {};
      for (n in attrs) {
        v = attrs[n];
        new_attrs[n] = v;
      }
      return {
        from: from,
        to: to,
        attrs: new_attrs
      };
    };
    extendSelection = function(selection, attrs) {
      var n, v, _results;
      _results = [];
      for (n in attrs) {
        v = attrs[n];
        _results.push(selection.attrs[n] = v);
      }
      return _results;
    };
    if (!((from != null) && (to != null))) {
      console.log("wasn't able to apply the selection..");
    }
    if (delta.type === "select") {
      cut_selection = function(reference, reference_name, direction, opposite_direction, opposite_reference, opposite_reference_name) {
        var new_selection, o, old_selection, opt_selection;
        if ((reference.selection != null) && reference.selection[reference_name] === reference) {
          return;
        }
        o = reference[direction];
        while ((o.selection == null) && (o.type !== "Delimiter")) {
          o = o[direction];
        }
        if ((o.selection == null) || o.selection[opposite_reference_name] === o) {
          return;
        }
        old_selection = o.selection;
        o = reference;
        while ((o.selection == null) && (o !== opposite_reference)) {
          o = o[direction];
        }
        if (o === old_selection[opposite_reference_name]) {
          if (opposite_reference_name === "to") {
            new_selection = createSelection(reference, old_selection[opposite_reference_name], old_selection.attrs);
          } else {
            new_selection = createSelection(old_selection[opposite_reference_name], reference, old_selection.attrs);
          }
          extendSelection(new_selection, delta.attrs);
          old_selection[opposite_reference_name] = reference[direction];
          old_selection[opposite_reference_name].selection = old_selection;
          new_selection[reference_name].selection = new_selection;
          return new_selection[opposite_reference_name].selection = new_selection;
        } else {
          if (opposite_reference_name === "to") {
            new_selection = createSelection(reference, opposite_reference, old_selection.attrs);
          } else {
            new_selection = createSelection(opposite_reference, reference, old_selection.attrs);
          }
          extendSelection(new_selection, delta.attrs);
          if (opposite_reference_name === "to") {
            opt_selection = createSelection(opposite_reference[opposite_direction], old_selection[opposite_reference_name], old_selection.attrs);
          } else {
            opt_selection = createSelection(old_selection[opposite_reference_name], opposite_reference[opposite_direction], old_selection.attrs);
          }
          old_selection[opposite_reference_name] = reference[direction];
          old_selection[opposite_reference_name].selection = old_selection;
          new_selection[reference_name].selection = new_selection;
          new_selection[opposite_reference_name].selection = new_selection;
          opt_selection[reference_name].selection = opt_selection;
          return opt_selection[opposite_reference_name].selection = opt_selection;
        }
      };
      ({
        cut_selection: function(reference, reference_name, direction, opposite_direction, opposite_reference, opposite_reference_name) {}
      });
      cut_selection(from, "from", "prev_cl", "next_cl", to, "to");
      cut_selection(to, "to", "next_cl", "prev_cl", from, "from");
      o = from;
      count = 0;
      while ((o !== to.next_cl) || count > 10) {
        count++;
        if (o.selection != null) {
          extendSelection(o.selection, delta.attrs);
          o = o.selection.to.next_cl;
        } else {
          start = o;
          while (o !== to) {
            o = o.next_cl;
          }
          end = o;
          selection = createSelection(start, end, delta.attrs);
          start.selection = selection;
          end.selection = selection;
          o = o.next_cl;
        }
      }
    } else if (delta.type === "unselect") {

    } else {
      throw new Error("unsupported delta!");
    }
    return delta;
  };

  YSelections.prototype._unapply = function(delta) {
    var from, to;
    from = this._model.HB.getOperation(delta.from);
    to = this._model.HB.getOperation(delta.to);
    if (!((from != null) && (to != null))) {
      console.log("wasn't able to unapply the selection..");
    }
    if (delta.type === "select") {
      delete from.selection;
      return delete to.selection;
    } else if (delta.type === "unselect") {

    } else {
      throw new Error("unsupported delta!");
    }
  };

  YSelections.prototype.select = function(from, to, attrs) {
    var delta;
    delta = {
      from: from.getUid(),
      to: to.getUid(),
      attrs: attrs,
      type: "select"
    };
    return this._model.applyDelta(delta);
  };

  YSelections.prototype.unselect = function(from, to, attrs) {
    var delta;
    delta = {
      from: from.getUid(),
      to: to.getUid(),
      attrs: attrs,
      type: "unselect"
    };
    return this._model.applyDelta(delta);
  };

  YSelections.prototype.observe = function(f) {
    return this._model.observe(f);
  };

  return YSelections;

})();

if (typeof window !== "undefined" && window !== null) {
  if (window.Y != null) {
    window.Y.Selections = YSelections;
  } else {
    throw new Error("You must first import Y!");
  }
}

if (typeof module !== "undefined" && module !== null) {
  module.exports = YSelections;
}


},{}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2NvZGlvL3dvcmtzcGFjZS95LXNlbGVjdGlvbnMvbm9kZV9tb2R1bGVzL2d1bHAtYnJvd3NlcmlmeS9ub2RlX21vZHVsZXMvYnJvd3NlcmlmeS9ub2RlX21vZHVsZXMvYnJvd3Nlci1wYWNrL19wcmVsdWRlLmpzIiwiL2hvbWUvY29kaW8vd29ya3NwYWNlL3ktc2VsZWN0aW9ucy9saWIveS1zZWxlY3Rpb25zLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0dBLElBQUEsV0FBQTs7QUFBQTtBQUNlLEVBQUEscUJBQUEsR0FBQSxDQUFiOztBQUFBLHdCQUVBLEtBQUEsR0FBTyxZQUZQLENBQUE7O0FBQUEsd0JBSUEsU0FBQSxHQUFXLFNBQUMsQ0FBRCxFQUFJLFNBQUosR0FBQTtBQUNULElBQUEsSUFBTyxtQkFBUDtBQUNFLE1BQUEsSUFBQyxDQUFBLE1BQUQsR0FBYyxJQUFBLFNBQVMsQ0FBQyxXQUFWLENBQXNCLElBQXRCLEVBQXlCLEVBQXpCLENBQTRCLENBQUMsT0FBN0IsQ0FBQSxDQUFkLENBREY7S0FBQTtXQUVBLElBQUMsQ0FBQSxPQUhRO0VBQUEsQ0FKWCxDQUFBOztBQUFBLHdCQVNBLFNBQUEsR0FBVyxTQUFFLE1BQUYsR0FBQTtBQUFVLElBQVQsSUFBQyxDQUFBLFNBQUEsTUFBUSxDQUFWO0VBQUEsQ0FUWCxDQUFBOztBQUFBLHdCQVdBLE1BQUEsR0FBUSxTQUFDLEtBQUQsR0FBQTtBQUVOLFFBQUEsMEZBQUE7QUFBQSxJQUFBLElBQUEsR0FBTyxJQUFDLENBQUEsTUFBTSxDQUFDLEVBQUUsQ0FBQyxZQUFYLENBQXdCLEtBQUssQ0FBQyxJQUE5QixDQUFQLENBQUE7QUFBQSxJQUNBLEVBQUEsR0FBSyxJQUFDLENBQUEsTUFBTSxDQUFDLEVBQUUsQ0FBQyxZQUFYLENBQXdCLEtBQUssQ0FBQyxFQUE5QixDQURMLENBQUE7QUFBQSxJQUVBLGVBQUEsR0FBa0IsU0FBQyxJQUFELEVBQU8sRUFBUCxFQUFXLEtBQVgs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LCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKX12YXIgZj1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwoZi5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxmLGYuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiXG5cblxuY2xhc3MgWVNlbGVjdGlvbnNcbiAgY29uc3RydWN0b3I6ICgpLT5cblxuICBfbmFtZTogXCJTZWxlY3Rpb25zXCJcblxuICBfZ2V0TW9kZWw6IChZLCBPcGVyYXRpb24pIC0+XG4gICAgaWYgbm90IEBfbW9kZWw/XG4gICAgICBAX21vZGVsID0gbmV3IE9wZXJhdGlvbi5Db21wb3NpdGlvbihALCBbXSkuZXhlY3V0ZSgpXG4gICAgQF9tb2RlbFxuXG4gIF9zZXRNb2RlbDogKEBfbW9kZWwpLT5cblxuICBfYXBwbHk6IChkZWx0YSktPlxuICAgICMgVE9ETzogY3VycmVudGx5LCBhcHBsaWVzIHRoZSBkZWx0YSBfYXMgaXNfLlxuICAgIGZyb20gPSBAX21vZGVsLkhCLmdldE9wZXJhdGlvbiBkZWx0YS5mcm9tXG4gICAgdG8gPSBAX21vZGVsLkhCLmdldE9wZXJhdGlvbiBkZWx0YS50b1xuICAgIGNyZWF0ZVNlbGVjdGlvbiA9IChmcm9tLCB0bywgYXR0cnMpLT5cbiAgICAgIG5ld19hdHRycyA9IHt9XG4gICAgICBmb3Igbix2IG9mIGF0dHJzXG4gICAgICAgIG5ld19hdHRyc1tuXSA9IHZcbiAgICAgIHtcbiAgICAgICAgZnJvbTogZnJvbVxuICAgICAgICB0bzogdG9cbiAgICAgICAgYXR0cnM6IG5ld19hdHRyc1xuICAgICAgfVxuXG4gICAgZXh0ZW5kU2VsZWN0aW9uID0gKHNlbGVjdGlvbiwgYXR0cnMpLT5cbiAgICAgIGZvciBuLHYgb2YgYXR0cnNcbiAgICAgICAgc2VsZWN0aW9uLmF0dHJzW25dID0gdlxuXG4gICAgaWYgbm90IChmcm9tPyBhbmQgdG8/KVxuICAgICAgY29uc29sZS5sb2cgXCJ3YXNuJ3QgYWJsZSB0byBhcHBseSB0aGUgc2VsZWN0aW9uLi5cIlxuICAgIGlmIGRlbHRhLnR5cGUgaXMgXCJzZWxlY3RcIlxuICAgICAgIyBBbGdvcml0aG0gb3ZlcnZpZXc6XG4gICAgICAjIDEuIGN1dCBvZmYgdGhlIHNlbGVjdGlvbiB0aGF0IGludGVyc2VjdHMgd2l0aCBmcm9tXG4gICAgICAjIDIuIGN1dCBvZmYgdGhlIHNlbGVjdGlvbiB0aGF0IGludGVyc2VjdHMgd2l0aCB0b1xuICAgICAgIyAzLiBleHRlbmQgLyBhZGQgc2VsZWN0aW9ucyBpbiBiZXR3ZWVuXG5cbiAgICAgICMgZS5nLiAgICAgICAgICAgZnJvbSAgICAgLCBcImZyb21cIiAgICAgICAgLCBcInByZXZfY2xcIiwgXCJuZXh0X2NsXCIgICAgICAgICAsIHRvICAgICAgICAgICAgICAgICwgXCJ0b1wiXG4gICAgICBjdXRfc2VsZWN0aW9uID0gKHJlZmVyZW5jZSwgcmVmZXJlbmNlX25hbWUsIGRpcmVjdGlvbiwgb3Bwb3NpdGVfZGlyZWN0aW9uLCBvcHBvc2l0ZV9yZWZlcmVuY2UsIG9wcG9zaXRlX3JlZmVyZW5jZV9uYW1lKS0+XG4gICAgICAgIGlmIHJlZmVyZW5jZS5zZWxlY3Rpb24/IGFuZCByZWZlcmVuY2Uuc2VsZWN0aW9uW3JlZmVyZW5jZV9uYW1lXSBpcyByZWZlcmVuY2VcbiAgICAgICAgICAjIGRvZXMgbm90IGludGVyc2VjdCwgYmVjYXVzZSB0aGUgc3RhcnQgaXMgYWxyZWFkeSBzZWxlY3RlZFxuICAgICAgICAgIHJldHVyblxuICAgICAgICBvID0gcmVmZXJlbmNlW2RpcmVjdGlvbl1cbiAgICAgICAgd2hpbGUgKG5vdCBvLnNlbGVjdGlvbj8pIGFuZCAoby50eXBlIGlzbnQgXCJEZWxpbWl0ZXJcIilcbiAgICAgICAgICBvID0gb1tkaXJlY3Rpb25dXG4gICAgICAgIGlmIChub3Qgby5zZWxlY3Rpb24/KSBvciBvLnNlbGVjdGlvbltvcHBvc2l0ZV9yZWZlcmVuY2VfbmFtZV0gaXMgb1xuICAgICAgICAgICMgbm8gaW50ZXJzZWN0aW9uXG4gICAgICAgICAgcmV0dXJuXG5cbiAgICAgICAgIyB0aGlzIGlzIGEgcmVmZXJlbmNlIGZvciB0aGUgc2VsZWN0aW9ucyB0aGF0IGFyZSBjcmVhdGVkOlxuICAgICAgICAjIG9sZCBpcyBvdXRlciAobm90IGJldHdlZW4gJGZyb20gJHRvKVxuICAgICAgICAjIG5ldyBpcyBpbm5lciAoaW5iZXR3ZWVuICRmcm9tICR0bylcbiAgICAgICAgIyBvcHQgaXMgb3V0ZXIgaW4gb3Bwb3NpdGVfZGlyZWN0aW9uXG4gICAgICAgICNcbiAgICAgICAgb2xkX3NlbGVjdGlvbiA9IG8uc2VsZWN0aW9uXG5cbiAgICAgICAgIyBjaGVjayBpZiBmb3VuZCBzZWxlY3Rpb24gaW50ZXJzZWN0cyB3aXRoIG9wcG9zaXRlX3JlZmVyZW5jZVxuICAgICAgICBvID0gcmVmZXJlbmNlXG4gICAgICAgIHdoaWxlIChub3Qgby5zZWxlY3Rpb24/KSBhbmQgKG8gaXNudCBvcHBvc2l0ZV9yZWZlcmVuY2UpXG4gICAgICAgICAgbyA9IG9bZGlyZWN0aW9uXVxuICAgICAgICBpZiBvIGlzIG9sZF9zZWxlY3Rpb25bb3Bwb3NpdGVfcmVmZXJlbmNlX25hbWVdXG4gICAgICAgICAgIyBubyBpbnRlcnNlY3Rpb24gd2l0aCBvcHBvc2l0ZV9yZWZlcmVuY2UhXG4gICAgICAgICAgIyBjcmVhdGUgbmV3IHNlbGVjdGlvblxuICAgICAgICAgIGlmIG9wcG9zaXRlX3JlZmVyZW5jZV9uYW1lIGlzIFwidG9cIlxuICAgICAgICAgICAgbmV3X3NlbGVjdGlvbiA9IGNyZWF0ZVNlbGVjdGlvbiByZWZlcmVuY2UsIG9sZF9zZWxlY3Rpb25bb3Bwb3NpdGVfcmVmZXJlbmNlX25hbWVdLCBvbGRfc2VsZWN0aW9uLmF0dHJzXG4gICAgICAgICAgZWxzZVxuICAgICAgICAgICAgbmV3X3NlbGVjdGlvbiA9IGNyZWF0ZVNlbGVjdGlvbiBvbGRfc2VsZWN0aW9uW29wcG9zaXRlX3JlZmVyZW5jZV9uYW1lXSwgcmVmZXJlbmNlLCBvbGRfc2VsZWN0aW9uLmF0dHJzXG5cbiAgICAgICAgICBleHRlbmRTZWxlY3Rpb24gbmV3X3NlbGVjdGlvbiwgZGVsdGEuYXR0cnNcbiAgICAgICAgICAjIHVwZGF0ZSBvbGQgc2VsZWN0aW9uXG4gICAgICAgICAgb2xkX3NlbGVjdGlvbltvcHBvc2l0ZV9yZWZlcmVuY2VfbmFtZV0gPSByZWZlcmVuY2VbZGlyZWN0aW9uXVxuICAgICAgICAgICMgdXBkYXRlIHJlZmVyZW5jZXNcbiAgICAgICAgICBvbGRfc2VsZWN0aW9uW29wcG9zaXRlX3JlZmVyZW5jZV9uYW1lXS5zZWxlY3Rpb24gPSBvbGRfc2VsZWN0aW9uXG4gICAgICAgICAgbmV3X3NlbGVjdGlvbltyZWZlcmVuY2VfbmFtZV0uc2VsZWN0aW9uID0gbmV3X3NlbGVjdGlvblxuICAgICAgICAgIG5ld19zZWxlY3Rpb25bb3Bwb3NpdGVfcmVmZXJlbmNlX25hbWVdLnNlbGVjdGlvbiA9IG5ld19zZWxlY3Rpb25cbiAgICAgICAgZWxzZVxuICAgICAgICAgICMgdGhlcmUgaXMgYW4gaW50ZXJzZWN0aW9uIHdpdGggb3Bwb3NpdGVfcmVmZXJlbmNlIVxuICAgICAgICAgICMgY3JlYXRlIG5ldyBzZWxlY3Rpb25cbiAgICAgICAgICBpZiBvcHBvc2l0ZV9yZWZlcmVuY2VfbmFtZSBpcyBcInRvXCJcbiAgICAgICAgICAgIG5ld19zZWxlY3Rpb24gPSBjcmVhdGVTZWxlY3Rpb24gcmVmZXJlbmNlLCBvcHBvc2l0ZV9yZWZlcmVuY2UsIG9sZF9zZWxlY3Rpb24uYXR0cnNcbiAgICAgICAgICBlbHNlXG4gICAgICAgICAgICBuZXdfc2VsZWN0aW9uID0gY3JlYXRlU2VsZWN0aW9uIG9wcG9zaXRlX3JlZmVyZW5jZSwgcmVmZXJlbmNlLCBvbGRfc2VsZWN0aW9uLmF0dHJzXG5cbiAgICAgICAgICBleHRlbmRTZWxlY3Rpb24gbmV3X3NlbGVjdGlvbiwgZGVsdGEuYXR0cnNcbiAgICAgICAgICBpZiBvcHBvc2l0ZV9yZWZlcmVuY2VfbmFtZSBpcyBcInRvXCJcbiAgICAgICAgICAgIG9wdF9zZWxlY3Rpb24gPSBjcmVhdGVTZWxlY3Rpb24gb3Bwb3NpdGVfcmVmZXJlbmNlW29wcG9zaXRlX2RpcmVjdGlvbl0sIG9sZF9zZWxlY3Rpb25bb3Bwb3NpdGVfcmVmZXJlbmNlX25hbWVdLCBvbGRfc2VsZWN0aW9uLmF0dHJzXG4gICAgICAgICAgZWxzZVxuICAgICAgICAgICAgb3B0X3NlbGVjdGlvbiA9IGNyZWF0ZVNlbGVjdGlvbiBvbGRfc2VsZWN0aW9uW29wcG9zaXRlX3JlZmVyZW5jZV9uYW1lXSwgb3Bwb3NpdGVfcmVmZXJlbmNlW29wcG9zaXRlX2RpcmVjdGlvbl0sIG9sZF9zZWxlY3Rpb24uYXR0cnNcblxuICAgICAgICAgICMgdXBkYXRlIG9sZCBzZWxlY3Rpb25cbiAgICAgICAgICBvbGRfc2VsZWN0aW9uW29wcG9zaXRlX3JlZmVyZW5jZV9uYW1lXSA9IHJlZmVyZW5jZVtkaXJlY3Rpb25dXG4gICAgICAgICAgIyB1cGRhdGUgcmVmZXJlbmNlc1xuICAgICAgICAgIG9sZF9zZWxlY3Rpb25bb3Bwb3NpdGVfcmVmZXJlbmNlX25hbWVdLnNlbGVjdGlvbiA9IG9sZF9zZWxlY3Rpb25cbiAgICAgICAgICBuZXdfc2VsZWN0aW9uW3JlZmVyZW5jZV9uYW1lXS5zZWxlY3Rpb24gPSBuZXdfc2VsZWN0aW9uXG4gICAgICAgICAgbmV3X3NlbGVjdGlvbltvcHBvc2l0ZV9yZWZlcmVuY2VfbmFtZV0uc2VsZWN0aW9uID0gbmV3X3NlbGVjdGlvblxuICAgICAgICAgIG9wdF9zZWxlY3Rpb25bcmVmZXJlbmNlX25hbWVdLnNlbGVjdGlvbiA9IG9wdF9zZWxlY3Rpb25cbiAgICAgICAgICBvcHRfc2VsZWN0aW9uW29wcG9zaXRlX3JlZmVyZW5jZV9uYW1lXS5zZWxlY3Rpb24gPSBvcHRfc2VsZWN0aW9uXG5cbiAgICAgICMgMS4gY3V0IG9mZiB0aGUgc2VsZWN0aW9uIHRoYXQgaW50ZXJzZWN0cyB3aXRoIGZyb21cbiAgICAgICMgZS5nLiAgICAgICAgICAgZnJvbSAgICAgLCBcImZyb21cIiAgICAgICAgLCBcInByZXZfY2xcIiwgXCJuZXh0X2NsXCIgICAgICAgICAsIHRvICAgICAgICAgICAgICAgICwgXCJ0b1wiXG4gICAgICBjdXRfc2VsZWN0aW9uIDogKHJlZmVyZW5jZSwgcmVmZXJlbmNlX25hbWUsIGRpcmVjdGlvbiwgb3Bwb3NpdGVfZGlyZWN0aW9uLCBvcHBvc2l0ZV9yZWZlcmVuY2UsIG9wcG9zaXRlX3JlZmVyZW5jZV9uYW1lKS0+XG4gICAgICBjdXRfc2VsZWN0aW9uKGZyb20sIFwiZnJvbVwiLCBcInByZXZfY2xcIiwgXCJuZXh0X2NsXCIsIHRvICAsIFwidG9cIilcbiAgICAgICMgMi4gY3V0IG9mZiB0aGUgc2VsZWN0aW9uIHRoYXQgaW50ZXJzZWN0cyB3aXRoIHRvXG4gICAgICBjdXRfc2VsZWN0aW9uKHRvICAsIFwidG9cIiAgLCBcIm5leHRfY2xcIiwgXCJwcmV2X2NsXCIsIGZyb20sIFwiZnJvbVwiKVxuICAgICAgIyAzLiBleHRlbmQgLyBhZGQgc2VsZWN0aW9ucyBpbiBiZXR3ZWVuXG4gICAgICBvID0gZnJvbVxuICAgICAgY291bnQgPSAwXG4gICAgICB3aGlsZSAobyBpc250IHRvLm5leHRfY2wpIG9yIGNvdW50ID4gMTBcbiAgICAgICAgY291bnQrK1xuICAgICAgICBpZiBvLnNlbGVjdGlvbj9cbiAgICAgICAgICAjIGp1c3QgZXh0ZW5kIHRoZSBleGlzdGluZyBzZWxlY3Rpb25cbiAgICAgICAgICBleHRlbmRTZWxlY3Rpb24gby5zZWxlY3Rpb24sIGRlbHRhLmF0dHJzXG4gICAgICAgICAgbyA9IG8uc2VsZWN0aW9uLnRvLm5leHRfY2xcbiAgICAgICAgZWxzZVxuICAgICAgICAgICMgY3JlYXRlIGEgbmV3IHNlbGVjdGlvbiAodW50aWwgeW91IGZpbmQgdGhlIG5leHQgb25lKVxuICAgICAgICAgIHN0YXJ0ID0gb1xuICAgICAgICAgIHdoaWxlIG8gaXNudCB0b1xuICAgICAgICAgICAgbyA9IG8ubmV4dF9jbFxuICAgICAgICAgIGVuZCA9IG9cbiAgICAgICAgICBzZWxlY3Rpb24gPSBjcmVhdGVTZWxlY3Rpb24gc3RhcnQsIGVuZCwgZGVsdGEuYXR0cnNcbiAgICAgICAgICBzdGFydC5zZWxlY3Rpb24gPSBzZWxlY3Rpb25cbiAgICAgICAgICBlbmQuc2VsZWN0aW9uID0gc2VsZWN0aW9uXG4gICAgICAgICAgbyA9IG8ubmV4dF9jbFxuXG4gICAgZWxzZSBpZiBkZWx0YS50eXBlIGlzIFwidW5zZWxlY3RcIlxuICAgICAgIyAuLlxuICAgIGVsc2VcbiAgICAgIHRocm93IG5ldyBFcnJvciBcInVuc3VwcG9ydGVkIGRlbHRhIVwiXG4gICAgcmV0dXJuIGRlbHRhICMgaXQgaXMgbmVjZXNzYXJ5IHRoYXQgZGVsdGEgaXMgcmV0dXJuZWQgaW4gdGhlIHdheSBpdCB3YXMgYXBwbGllZCBvbiB0aGUgZ2xvYmFsIGRlbHRhLlxuICAgICMgc28gdGhhdCB5anMgY2FuIGtub3cgZXhhY3RseSB3aGF0IHdhcyBhcHBsaWVkLlxuXG4gICMgXCJ1bmRvXCIgYSBkZWx0YSBmcm9tIHRoZSBjb21wb3NpdGlvbl92YWx1ZVxuICBfdW5hcHBseTogKGRlbHRhKS0+XG4gICAgZnJvbSA9IEBfbW9kZWwuSEIuZ2V0T3BlcmF0aW9uIGRlbHRhLmZyb21cbiAgICB0byA9IEBfbW9kZWwuSEIuZ2V0T3BlcmF0aW9uIGRlbHRhLnRvXG4gICAgaWYgbm90IChmcm9tPyBhbmQgdG8/KVxuICAgICAgY29uc29sZS5sb2cgXCJ3YXNuJ3QgYWJsZSB0byB1bmFwcGx5IHRoZSBzZWxlY3Rpb24uLlwiXG4gICAgaWYgZGVsdGEudHlwZSBpcyBcInNlbGVjdFwiXG4gICAgICBkZWxldGUgZnJvbS5zZWxlY3Rpb25cbiAgICAgIGRlbGV0ZSB0by5zZWxlY3Rpb25cbiAgICBlbHNlIGlmIGRlbHRhLnR5cGUgaXMgXCJ1bnNlbGVjdFwiXG4gICAgICAjIC4uXG4gICAgZWxzZVxuICAgICAgdGhyb3cgbmV3IEVycm9yIFwidW5zdXBwb3J0ZWQgZGVsdGEhXCJcblxuICAjIHVwZGF0ZSB0aGUgZ2xvYmFsRGVsdGEgd2l0aCBkZWx0YVxuXG5cbiAgIyBzZWxlY3QgX2Zyb21fLCBfdG9fIHdpdGggYW4gX2F0dHJpYnV0ZV9cbiAgc2VsZWN0OiAoZnJvbSwgdG8sIGF0dHJzKS0+XG4gICAgZGVsdGEgPSAjIHByb2JhYmx5IG5vdCBhcyBlYXN5IGFzIHRoaXNcbiAgICAgIGZyb206IGZyb20uZ2V0VWlkKClcbiAgICAgIHRvOiB0by5nZXRVaWQoKVxuICAgICAgYXR0cnM6IGF0dHJzXG4gICAgICB0eXBlOiBcInNlbGVjdFwiXG5cbiAgICBAX21vZGVsLmFwcGx5RGVsdGEoZGVsdGEpXG5cbiAgIyB1bnNlbGVjdCBfZnJvbV8sIF90b18gd2l0aCBhbiBfYXR0cmlidXRlX1xuICB1bnNlbGVjdDogKGZyb20sIHRvLCBhdHRycyktPlxuICAgIGRlbHRhID0gIyBwcm9iYWJseSBub3QgYXMgZWFzeSBhcyB0aGlzXG4gICAgICBmcm9tOiBmcm9tLmdldFVpZCgpXG4gICAgICB0bzogdG8uZ2V0VWlkKClcbiAgICAgIGF0dHJzOiBhdHRyc1xuICAgICAgdHlwZTogXCJ1bnNlbGVjdFwiXG5cbiAgICBAX21vZGVsLmFwcGx5RGVsdGEoZGVsdGEpXG5cbiAgb2JzZXJ2ZTogKGYpLT5cbiAgICBAX21vZGVsLm9ic2VydmUgZlxuXG5cbmlmIHdpbmRvdz9cbiAgaWYgd2luZG93Llk/XG4gICAgd2luZG93LlkuU2VsZWN0aW9ucyA9IFlTZWxlY3Rpb25zXG4gIGVsc2VcbiAgICB0aHJvdyBuZXcgRXJyb3IgXCJZb3UgbXVzdCBmaXJzdCBpbXBvcnQgWSFcIlxuXG5pZiBtb2R1bGU/XG4gIG1vZHVsZS5leHBvcnRzID0gWVNlbGVjdGlvbnNcblxuXG5cblxuXG5cbiJdfQ==
